<h1>Tind Spreadsheet Validator</h1>
<p>This form is for creating and validating a Tind Marc batch load using a spreadsheet. Metadata will be supplied from spreadsheet.</p>
<p>Form field values will overwrite similarily named fields in spreadsheet if present</p>
<p class="d-inline-flex gap-1">
  <button class="btn btn-primary" type="button" data-bs-toggle="collapse" data-bs-target="#collapseExample" aria-expanded="false" aria-controls="collapseExample">
    Spreadsheet guidelines
  </button>
</p>
<div class="collapse" id="collapseExample">
  <div class="card card-body">
    <ul>
      <li>For adding URL's (FFT's) the uploaded spreadsheet will need a header named "Filename". If it's a filestub e.g. "cubanc_c29293923" it will recursively search for any files matching that pattern and create FFT's (cubanc_c29293923_001.jpg, cubanc_c29293923_002.jpg etc.). If a specific filename is given it will recursively search for that specific file. e.g. "cubanc_c29293923.jpg"</li>
      <li>The recursive search for files will begin at the resource directory given in the form. It's assumed the directory will be below /srv/da</li>
      <li>FFT's will be created and take the form https://digitalassets.lib.berkeley.edu/${resource_directory}/${filename}"</li>
      <li>It is required for there to be filenames in the spreadsheet with a "Filename" header defined.</li>
      <li>If the input spreadsheet contains columns for any of the fields defined in this form they will be ignored (including FFT's). The values for those columns will be supplied via this form</li>
    </ul>    
  </div>
</div>
<%= form_with(url: '', local: true, target: '_blank') do |f| %>  
  <% accept_mime_types = 'text/csv, application/vnd.openxmlformats-officedocument.spreadsheetml.sheet' %> 
  <%= hidden_field_tag :email, @email %>
  <hr />
  <p class="required-note">Required</p>
  <div class="form-label form-group required">
    <%= f.label :input_file, 'Input file: (csv or xlsx)', class: 'control-label' %>
  </div>
  <div class="form-input required mb-4">
    <%= f.file_field :input_file, class: 'form-control add-required', aria: { required: true }, required: true, accept: accept_mime_types %>
  </div>

  <div class="form-label form-group required">
  <%= label_tag('directory', 'Resource Directory', class: 'control-label') %>
    <span style="font-size:0.8em">(example: librettos/ucb/incoming or /librettos/ucb/incoming)</span>
  </div>
  <div class="form-input required mb-4">
    <%= f.text_field(:directory, :onkeyup => 'checkFormInputs()', class: 'narrow form-control', autofocus: true) %>
  </div>

  <div class="form-label form-group required">
    <%= label_tag('852__c', '852_c (Library location)', class: 'control-label') %>
  </div>
  <div class="form-input required mb-4">
    <%= f.text_field(:'852__c', :onkeyup => 'checkFormInputs()', class: 'narrow form-control add-required', aria: { required: true }, required: true, autofocus: true) %>
  </div>

  <div class="form-label form-group required">
    <%= label_tag('902__n', '902_n (your initials)', class: 'control-label') %>
  </div>
  <div class="form-input required mb-4">
    <%= f.text_field(:'902__n', :onkeyup => 'checkFormInputs()', class: 'narrow form-control add-required', aria: { required: true }, required: true, autofocus: true) %>
  </div>

  <div class="form-label form-group required">
    <%= label_tag('980__a', '980_a (internal collection code)', class: 'control-label') %>
  </div>
  <div class="form-input required mb-4">
    <%= f.text_field(:'980__a', :onkeyup => 'checkFormInputs()', class: 'narrow form-control add-required', aria: { required: true }, required: true, autofocus: true) %>
  </div>

  <div class="form-label form-group required">
    <%= label_tag('982__a', '982_a (collection short name)', class: 'control-label') %>
  </div>
  <div class="form-input required mb-4">
    <%= f.text_field(:'982__a', :onkeyup => 'checkFormInputs()', class: 'narrow form-control add-required', aria: { required: true }, required: true, autofocus: true) %>
  </div>

  <div class="form-label form-group required">
    <%= label_tag('982__b', '982_b (collection long name)', class: 'control-label') %>
  </div>
  <div class="form-input required mb-4">
    <%= f.text_field(:'982__b', :onkeyup => 'checkFormInputs()', class: 'narrow form-control add-required', aria: { required: true }, required: true, autofocus: true) %>
  </div>

  <div class="form-label form-group">
    <%= label_tag('982__p', '982_p (optional)', class: 'control-label') %>
  </div>
  <div class="form-input mb-4">
    <%= f.text_field(:'982__p', :onkeyup => 'checkFormInputs()', class: 'narrow form-control', required: false, autofocus: true) %>
  </div>

  <div class="form-label form-group required">
    <%= label_tag('336__a', '336_a (Resource Type (for facet))', class: 'control-label') %>
  </div>
  <div class="form-input required mb-4">
    <%= f.select :'336__a', Rails.application.config.tind_resource_types %>
  </div>

  <div class="form-label form-group required">
    <%= label_tag('540__a', '540_a (Rights statement, can be edited)', class: 'control-label') %>
  </div>
  <div class="form-input mb-4 required">
    <%= f.text_area(:'540__a', :onkeyup => 'checkFormInputs()', class: 'narrow form-control', autofocus: true, value: t('tind_marc_batch.standard_rights_statement'), rows: 8, required: true ) %>
  </div>

  <div class="form-label form-group">
    <%= label_tag('991__a', 'Restriction (optional)', class: 'control-label') %>
  </div>
  <div class="form-input mb-4">
    <%= f.select :'991__a', Rails.application.config.tind_restrictions, include_blank: true %>
  </div>

  <div class="form-input">
   <%= f.submit(class: 'btn btn-primary', value: 'Create Batch') %> 
  </div>
<% end %>
