<h1>Controlled Digital Lending</h1>

<% @lending_item = @lending_item_loan.lending_item %>

<section class="record">
  <table class="table table-bordered table-striped" style="width: auto;">
    <tbody>
    <%= render partial: 'lending_items/metadata' %>

    <% if @lending_item_loan.persisted? %>
      <tr>
        <th>Loan status:</th>
        <td><%= @lending_item_loan.loan_status %></td>
      </tr>

      <tr>
        <th>Checked out:</th>
        <td><%= @lending_item_loan.loan_date %></td>
      </tr>

      <tr>
        <th>Due:</th>
        <td><%= @lending_item_loan.due_date %></td>
      </tr>

      <% if @lending_item_loan.complete? %>
        <tr>
          <th>Returned:</th>
          <td><%= @lending_item_loan.return_date %></td>
        </tr>
      <% end %>
    <% end %>
    </tbody>

    <tfoot>
    <tr>
      <td></td>
      <td>
        <% if @lending_item_loan.active? %>
          <%= form_with(url: lending_item_loans_return_path, id: 'return-form', local: true) do |f| %>
            <%= f.hidden_field('lending_item_id', value: @lending_item.id) %>
            <%= f.submit('Return now', style: 'width: 100%;') %>
          <% end %>
        <% else %>
          <%= form_with(url: lending_item_loans_checkout_path, id: 'checkout-form', local: true) do |f| %>
            <%= f.hidden_field('lending_item_id', value: @lending_item.id) %>
            <%= f.submit('Check out', style: 'width: 100%;', disabled: !@lending_item.available?, disable_with: 'No copies available') %>
          <% end %>
        <% end %>
      </td>
    </tr>
    </tfoot>
  </table>
</section>

<% if @lending_item_loan.active? %>
  <aside class="viewer">
    <%= render(partial: 'lending_items/viewer') %>
  </aside>
<% end %>
