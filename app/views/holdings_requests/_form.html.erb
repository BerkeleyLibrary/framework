<%# TODO: Form validation (cf. TIND) %>

<%
  allow_immediate = user.framework_admin?
  show_immediate = allow_immediate || holdings_request.immediate?
%>

<section id="holdings-request-form">
  <% if holdings_request.errors.any? %>
    <div class="alert alert-danger fade show" role="alert">
      <h5 class="alert-heading">The following errors have been found. Please correct them before submitting the form again:</h5>
      <table class="errors">
        <% holdings_request.errors.each do |error| %>
          <tr>
            <th scope="row"><%= t("activerecord.attributes.holdings_request.#{error.attribute}") %></th>
            <td><%= error.message %></td>
          </tr>
        <% end %>
      </table>
    </div>
  <% end %>

  <%= form_with(model: holdings_request) do |form| %>
    <ul>
      <li>
        <div class="form-label form-group required">
          <%= form.label :email, class: 'control-label' %>
        </div>
        <div class="form-input required mb-4">
          <%= form.text_field :email, class: 'form-control add-required' %>
        </div>
      </li>
      <li>
        <div class="form-label form-group required">
          <%= form.label :input_file, class: 'control-label' %>
        </div>
        <div class="form-input required mb-4">
          <%= form.file_field :input_file, class: 'form-control add-required' %>
        </div>
      </li>
      <li>
        <fieldset class="required">
          <legend>Include</legend>
          <ul class="form-input required mb-4">
            <li>
              <%= form.check_box :rlf %>
              <%= form.label :rlf %>
            </li>
            <li>
              <%= form.check_box :uc %>
              <%= form.label :uc %>
            </li>
            <li>
              <%= form.check_box :hathi %>
              <%= form.label :hathi %>
            </li>
          </ul>
        </fieldset>
      </li>
      <% if show_immediate %>
        <li>
          <fieldset>
            <legend>Schedule request to run</legend>
            <ul class="form-input mb-4">
              <li>
                <%= form.radio_button :immediate, false, value: false %>
                <%= form.label :immediate, 'off hours', value: false %>
              </li>
              <li>
                <%= form.radio_button :immediate, true, value: true %>
                <%= form.label :immediate, 'immediately', value: true %>
              </li>
            </ul>
          </fieldset>
        </li>
      <% end %>
      <li>
        <p class="required-note">Required</p>
      </li>
      <li>
        <%= form.submit(class: %w[btn btn-primary]) %>
      </li>
    </ul>
  <% end %>

</section>
